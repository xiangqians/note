<!--
 | @author xiangqian
 | @date 18:50 2023/10/14
 |-->
{{ define "common/table" }}
<script type="text/javascript">
    let variable = (function () {
        let obj = {}

        // i18n
        let i18n = {}
        i18n.name = '{{ Localize "i18n.name" .language }}'
        i18n.add = '{{ Localize "i18n.add" .language }}'
        i18n.addFolder = '{{ Localize "i18n.addFolder" .language }}'
        i18n.addMdFile = '{{ Localize "i18n.addMdFile" .language }}'
        i18n.uploadFile = '{{ Localize "i18n.uploadFile" .language }}'
        i18n.upload = '{{ Localize "i18n.upload" .language }}'
        i18n.upd = '{{ Localize "i18n.upd" .language }}'
        i18n.rename = '{{ Localize "i18n.rename" .language }}'
        i18n.cut = '{{ Localize "i18n.cut" .language }}'
        i18n.paste = '{{ Localize "i18n.paste" .language }}'
        i18n.del = '{{ Localize "i18n.del" .language }}'
        i18n.restore = '{{ Localize "i18n.restore" .language }}'
        i18n.permlyDel = '{{ Localize "i18n.permlyDel" .language }}'
        i18n.close = '{{ Localize "i18n.close" .language }}'
        i18n.copyAddress = '{{ Localize "i18n.copyAddress" .language }}'
        i18n.copied = '{{ Localize "i18n.copied" .language }}'
        obj.i18n = i18n

        // 上下文路径
        let contextPath = '{{ .contextPath }}'
        obj.contextPath = contextPath
        console.log('contextPath', contextPath)

        // 请求路径
        let path = '{{ .path }}'
        obj.path = path
        console.log('path', path)

        // 请求uri地址
        let uri = '{{ .uri }}'
        obj.uri = uri
        console.log('uri', uri)

        // 响应数据
        let resp = `{{ .resp }}`
        obj.resp = resp
        console.log('resp', JSON.parse(resp))

        // 当前页
        let current = '{{ .response.Data.Current }}'
        obj.current = current

        // 页数量
        let size = '{{ .response.Data.Size }}'
        obj.size = size

        // 搜索
        let search = '{{ .response.Data.Search }}'
        obj.search = search

        // 总数
        let total = '{{ .response.Data.Total }}'
        obj.total = total

        console.log(current, size, search, total)

        return obj
    })()
</script>

<msg>{{ .resp.Msg }}</msg>

<!-- 变量赋值 -->
{{ $page := .resp.Data }}
{{ $data := $page.Data }}
<div class="nowrap">
    <table>
        <thead>
        <tr>
            <td></td>
            <td>{{ Localize "i18n.name" .language }}</td>
            <td>{{ Localize "i18n.size" .language }}</td>
            <td>{{ Localize "i18n.addTime" .language }}</td>
            <td>{{ Localize "i18n.updTime" .language }}</td>
        </tr>
        </thead>
        <tbody>
        {{ $len := len $data }}
        {{ if gt $len 0 }}
        {{ range $index,$value := $data }}
        <tr id="{{ $value.Id }}" name="{{ $value.Name }}" del="{{ $value.Del }}">
            <!--
             | . 访问当前位置的上下文
             | $ 引用当前模板根级的上下文
             | $. 引用模板中的根级上下文
             |-->
            <td><img src="{{ $.contextPath }}/static/icon/{{ $value.Type }}.png"
                     title="{{ $value.Type }}"
                     onerror="this.onerror=''; this.src='{{ $.contextPath }}/static/icon/unknown.png'"></td>
            <td><a href="#">{{ $value.Name }}{{ if ne $value.Type "folder" }}.{{ $value.Type }}{{ end }}</a></td>
            <td>{{ HumanizFileSize $value.Size }}</td>
            <td>{{ HumanizUnix $value.AddTime }}</td>
            <td>{{ HumanizUnix $value.UpdTime }}</td>
        </tr>
        {{ end }}
        {{ else }}
        <tr class="no-data">
            <td colspan="5">{{ Localize "i18n.noData" }}</td>
        </tr>
        {{ end }}
        </tbody>
        <tfoot>
        <tr>
            <td colspan="5">
                <form action="{{ .contextPath }}/image" method="get">
                    <input name="current" value="1" type="hidden">
                    <input name="size" value="{{ $page.Size }}" type="hidden">
                    <input name="search"
                           type="text"
                           placeholder='{{ Localize "i18n.search" .language }}'
                           title="id:{id}&#10;name:{name}&#10;type:{type}"
                           value="{{ $page.Search }}">
                    <input name="t" value="{{ NowUnix }}" type="hidden">
                </form>
                {{ if le $page.Current 1 }}
                <span>{{ Localize "i18n.prev" .language }}</span>
                {{ else }}
                { $prev := Add $page.Current -1 }
                {{ $prev := -1 }}
                {{ if gt $prev $page.PageCount }}
                {{ $prev = $page.PageCount }}
                {{ end }}
                <span>
                    <a href="{{ $.contextPath }}/image?current={{ $prev }}&size={{ $page.Size }}&search={{ $page.Search }}&t={{ NowUnix }}">{{ Localize "i18n.prev" .language }}</a>
                </span>
                {{ end }}

                {{ $pageIndexes := $page.PageIndexes }}
                {{ $len := len $pageIndexes }}
                {{ if gt $len 0 }}
                {{ range $index,$pageIndex := $pageIndexes }}
                {{ if eq $pageIndex 0 }}
                <span>...</span>
                {{ else if eq $pageIndex $page.Current }}
                <span>{{ $pageIndex }}</span>
                {{ else }}
                <span>
                    <a href="{{ $.contextPath }}/image?current={{ $pageIndex }}&size={{ $page.Size }}&search={{ $page.Search }}&t={{ NowUnix }}">{{ $pageIndex }}</a>
                </span>
                {{ end }}
                {{ end }}
                {{ end }}

                {{ if ge $page.Current $page.PageCount }}
                <span>{{ Localize "i18n.next" .language }}</span>
                {{ else }}
                <span>
                    { $next := Add $page.Current 1 }
                    {{ $next := 1 }}
                    <a href="{{ $.contextPath }}/image?current={{ $next }}&size={{ $page.Size }}&search={{ $page.Search }}&t={{ NowUnix }}">{{ Localize "i18n.next" .language }}</a>
                </span>
                {{ end }}
            </td>
        </tr>
        </tfoot>
    </table>
    <table>
        <thead>
        <tr>
            <td></td>
        </tr>
        </thead>
        <tbody>
        {{ $len := len $data }}
        {{ if gt $len 0 }}
        {{ range $index,$value := $data }}
        <tr>
            <td></td>
        </tr>
        {{ end }}
        {{ else }}
        <tr>
            <td></td>
        </tr>
        {{ end }}
        </tbody>
        <tfoot>
        <tr>
            <td></td>
        </tr>
        </tfoot>
    </table>
</div>
{{ end }}