<!--
 | @author xiangqian
 | @date 22:53 2023/02/08
 |-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" rel="external nofollow" href="/static/favicon.ico">

    <!--
     | https://codemirror.net
     | GitHub: https://github.com/codemirror/codemirror5
     | doc: https://codemirror.net/5/doc/manual.html
     |-->
    <!-- 引入codemirror核心css文件 codemirror.css -->
    <link rel="stylesheet" href="/static/codemirror-5.65.11/lib/codemirror.css">

    <title>{{ Localize "i18n.edit" }}: {{ .f.Name }}</title>

    <style>

        .float {
            position: fixed;
            top: 30px;
            right: 50px;
            width: auto;
            height: auto;
            /*background: lightgray;*/
        }

    </style>
</head>
<body>

<p style="color: red;">{{ .msg }}</p>

<textarea type="text" style="width: 100%; height: 100%;">{{ .content }}</textarea>

<a class="float" href="/file/{{ .f.Id }}/edit" method="PUT" target="_blank">{{ Localize "i18n.save" }}</a>

</body>
</html>

<script type="text/javascript" src="/static/jquery-v3.6.2/min.js"></script>

<!-- 引入codemirror核心js文件 codemirror.js -->
<script type="text/javascript" src="/static/codemirror-5.65.11/lib/codemirror.js"></script>

<!-- 引入codemirror mode代码高亮js -->
<script type="text/javascript" src="/static/codemirror-5.65.11/mode/markdown/markdown.js"></script>


<script>
    ;
    (function () {
        let $textarea = $('textarea')
        let editor = CodeMirror.fromTextArea($textarea[0], {
            mode: 'markdown', // 语言模式
            lineNumbers: true,  // 显示行数
            // indentUnit: 4,         // 缩进单位为4
            smartIndent: true, //智能缩进
            styleActiveLine: true, // 当前行背景高亮
            lineWrapping: true, // 自动换行
            matchBrackets: true,  // 括号匹配
            autoRefresh: true,
        })
        let width = $textarea.css('width')
        let height = $textarea.css('height')
        editor.setSize(width, height);

        // 内容变化监听
        // https://codemirror.net/5/doc/manual.html#events
        editor.on("changes", function () {
            // console.log($script.val())
            editor.refresh()
            editor.save()
            // console.log(editor.getValue())
            // console.log($script.val())
        })
    })()
    ;
</script>