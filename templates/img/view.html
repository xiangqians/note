<!--
 | @author xiangqian
 | @date 12:33 2023/02/12
 |-->
<!DOCTYPE html>
{{ $data := .resp.Data }}
<html lang="en" uri="{{ .uri }}" url="{{ .url }}">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" rel="external nofollow" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/custom/custom.css" type="text/css"/>
    <title>{{ $data.Name }}</title>
    <style>
        body {
            text-align: center
        }
    </style>
</head>
<body>

<div class="float">
    <p style="color: red;">{{ .resp.Msg }}</p>
    <table border="1" cellspacing="0" cellpadding="10" align="center">
        <tbody>
        <tr>
            <td>{{ Localize "i18n.name" }}</td>
            <td>{{ $data.Name }}</td>
        </tr>
        <tr>
            <td>{{ Localize "i18n.type" }}</td>
            <td>{{ $data.Type }}</td>
        </tr>
        <tr>
            <td>{{ Localize "i18n.size" }}</td>
            <td>{{ HumanizFileSize $data.Size }}</td>
        </tr>
        <tr>
            <td>{{ Localize "i18n.addTime" }}</td>
            <td>{{ HumanizUnix $data.AddTime }}</td>
        </tr>
        <tr>
            <td>{{ Localize "i18n.updTime" }}</td>
            <td>{{ HumanizUnix $data.UpdTime }}</td>
        </tr>
        </tbody>
    </table>
    <br>

    {{ Localize "i18n.hist" }}
    <select name="hist">
        <option value="-1"></option>
        {{ $len := len $data.Hists }}
        {{ if gt $len 0 }}
        {{ range $index,$hist := $data.Hists }}
        <option value="{{ $index }}">
            {{ $hist.Name }}&nbsp;&nbsp;&nbsp;
            {{ $hist.Type }}&nbsp;&nbsp;&nbsp;
            {{ if eq $hist.UpdTime 0 }}{{ HumanizUnix $hist.AddTime }}{{ else }}{{ HumanizUnix $hist.UpdTime }}{{ end }}
        </option>
        {{ end }}
        {{ end }}
    </select>
    <br>
    <br>

    <form action="/img/upload" method="PUT" enctype="multipart/form-data">
        <input name="id" type="text" value="{{ $data.Id }}" hidden/>
        <input name="file" type="file" disabled/>
        <button ajaxE type="submit" disabled>{{ Localize "i18n.upload" }}</button>
    </form>
</div>

<div>
    <img src="{{ $data.Url }}" alt="{{ $data.Name }}">
</div>
<br>

</body>
</html>
<script type="text/javascript" src="/static/jquery-v3.6.2/min.js"></script>
<script type="text/javascript" src="/static/custom/custom.js"></script>
<script>
    ;
    (function () {

        // url
        let url = '{{ .url }}'
        // console.log(url)

        // hist
        let isHist = url.indexOf('hist') > 0
        // console.log(isHist)
        let idx = -1
        if (isHist) {
            let idxStr = url.substring(url.indexOf('hist/') + 'hist/'.length, url.indexOf('/view'))
            idx = parseInt(idxStr)
        }

        // 如果不是历史记录，则移除form的 disabled 属性
        if (!isHist) {
            $($("input[name='file']")[0]).attr('disabled', false)
            $($("button[type='submit']")[0]).attr('disabled', false)
        }

        // form
        custom.ajaxE($($('form')[0]))

        // select
        let $select = $($("select[name='hist']")[0])
        let options = $select.find("option")
        if (idx != -1) {
            for (let i = 0; i < options.length; i++) {
                let $option = $(options[i])
                let value = parseInt($option.attr('value'))
                // console.log(value)
                if (value === idx) {
                    $option.attr('selected', true)
                    break
                }
            }
        }

        $select.change(function () {
            let value = $select.find("option:selected").attr("value");
            // console.log(value)
            let url = null
            if (value === "-1") {
                url = '/img/{{ $data.Id }}/view'
            } else {
                url = '/img/{{ $data.Id }}/hist/' + value + '/view'
            }
            custom.ajaxReload(url, 'GET', null)
        });

    })()
</script>