<!--
 | @author xiangqian
 | @date 12:33 2023/02/12
 |-->
<!DOCTYPE html>
{{ $data := .resp.Data }}
<html lang="en" uri="{{ .uri }}" url="{{ .url }}">
<head>
    <meta charset="UTF-8">
    <link rel="shortcut icon" rel="external nofollow" href="/static/favicon.ico">
    <link rel="stylesheet" href="/static/custom/custom.css" type="text/css"/>
    <title>{{ $data.Name }}</title>
    <style>
        body {
            text-align: center
        }
    </style>
</head>
<body>

<div class="float">
    <p style="color: red;">{{ .resp.Msg }}</p>
    <table border="1" cellspacing="0" cellpadding="10" align="center">
        <tbody>
        <tr>
            <td>{{ Localize "i18n.name" }}</td>
            <td>{{ $data.Name }}</td>
        </tr>
        <tr>
            <td>{{ Localize "i18n.type" }}</td>
            <td>{{ $data.Type }}</td>
        </tr>
        <tr>
            <td>{{ Localize "i18n.size" }}</td>
            <td>{{ HumanizFileSize $data.Size }}</td>
        </tr>
        <tr>
            <td>{{ Localize "i18n.addTime" }}</td>
            <td>{{ HumanizUnix $data.AddTime }}</td>
        </tr>
        <tr>
            <td>{{ Localize "i18n.updTime" }}</td>
            <td>{{ HumanizUnix $data.UpdTime }}</td>
        </tr>
        </tbody>
    </table>
    <br>

    {{ Localize "i18n.hist" }}
    <select name="hist">
        <option value="-1" {{ if eq $data.HistIdx -1 }}selected{{ end }}></option>
        {{ $len := len $data.Hists }}
        {{ if gt $len 0 }}
        {{ range $index,$hist := $data.Hists }}
        <option value="{{ $index }}" {{ if eq $data.HistIdx $index }}selected{{ end }}>
            {{ $hist.Name }}&nbsp;&nbsp;&nbsp;{{ $hist.Type }}&nbsp;&nbsp;&nbsp;{{ HumanizUnix $hist.UpdTime }}
        </option>
        {{ end }}
        {{ end }}
    </select>
    <br>
    <br>

    <form action="/img/upload" method="PUT" enctype="multipart/form-data">
        <input name="id" type="text" value="{{ $data.Id }}" hidden/>
        <input name="file" type="file" {{ if ne $data.HistIdx -1 }}disabled{{ end }}/>
        <button ajaxE type="submit" {{ if ne $data.HistIdx -1 }}disabled{{ end }}>{{ Localize "i18n.upload" }}
        </button>
    </form>
</div>

<div>
    <img src="{{ $data.Url }}" alt="{{ $data.Name }}">
</div>
<br>

</body>
</html>
<script type="text/javascript" src="/static/jquery-v3.6.2/min.js"></script>
<script type="text/javascript" src="/static/custom/custom.js"></script>

<script>
    ;
    (function () {
        let options = $("option")
        for (let i = 0, len = options.length; i < len; i++) {
            let $option = $(options[i])
            $option.click(function () {
                console.log($option)
            })
        }

        let $select = $($("select[name='hist']")[0])
        $select.change(function (e) {
            let value = $select.find("option:selected").attr("value");
            // console.log(value)
            let url = '/img/{{ $data.Id }}/view'
            if (value !== "-1") {
                url += '?histIdx=' + value
            }
            custom.ajaxDefault(url, 'GET', null, 'form', true)
        });

    })()
</script>